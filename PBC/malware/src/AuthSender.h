#ifndef AUTHCLIENT_H
#define AUTHCLIENT_H


#include "NTL/ZZ_pXFactoring.h"
#include "NTL/vec_ZZ_p.h"
#include "NTL/ZZ.h"
#include "NTL/matrix.h"
#include "NTL/vec_vec_ZZ_p.h"
#include "NTL/BasicThreadPool.h"
#include "OLESender.h"

#if defined(__linux__)
        #include <sys/time.h>
        #include <sys/resource.h>
#elif defined(__APPLE__)
        #include <unistd.h>
        #include <sys/resource.h>
        #include <mach/mach.h>
#endif

using namespace std;
using std::vector;
using namespace chrono;
using namespace NTL;
#define DEBUG_SETUP 0
#define DEBUG_COMMIT 0

void authenticateS(int port, ZZ_pContext context, ZZ prime, int num_of_ole_instances, vec_ZZ_p Alpha, vec_ZZ_p Beta, vec_ZZ_p eval_pts, vec_ZZ_p *inSet) {
    int party = 2;

    NetIO* io;
    io = new NetIO(party == ALICE?nullptr:"127.0.0.1",port+2); 

    int setSize = 1;
    int ESPVecLen = 32;
    ZZ_pX polys[setSize];
       
    for(int i = 0 ; i < setSize; i++)
    {
        polys[i] = BuildFromRoots(inSet[i]);
    }
        

    ZZ_pX randomPolys[setSize];
    for(int i = 0; i < setSize; i++)
    {
        randomPolys[i] = random_ZZ_pX(ESPVecLen);
    }

    vec_ZZ_p poly_random_eval_set;
    poly_random_eval_set.SetLength(eval_pts.length() * setSize);
    vec_ZZ_p poly_ole_eval_set;
    poly_ole_eval_set.SetLength(eval_pts.length() * setSize);
    for(int i = 0, k = 0; i < setSize; i++)
    {
        for(int j = 0; j < eval_pts.length(); j++)
        {
            //cout << eval_pts[j] << endl;
            poly_random_eval_set[k] = eval(randomPolys[i], eval_pts[j]);
            //cout << poly[i] << endl;
            poly_ole_eval_set[k++] = eval(polys[i], eval_pts[j]);
            //cout << "check" << endl;

        }
    }

    vec_ZZ_p random_elems[setSize];
    for(int i = 0; i < setSize;i++)
    {
        random_elems[i] = random_vec_ZZ_p(eval_pts.length());
    }

    vec_ZZ_p set_of_ole_mul;
    set_of_ole_mul.SetLength(2*eval_pts.length() * setSize);
    vec_ZZ_p set_of_ole_add;
    set_of_ole_add.SetLength(2*eval_pts.length() * setSize);
    int k = 0;

    for(int i = 0; i < setSize; i++)
    {
        for(int j = 0; j < eval_pts.length(); j++)
        {
            set_of_ole_mul[k] = poly_random_eval_set[k];
            set_of_ole_add[k] =  poly_ole_eval_set[k];
            k++;
        }
    }

    for(int i = 0, t = 0; i < setSize; i++)
    {
        for(int j = 0; j < eval_pts.length(); j++)
        {
            set_of_ole_mul[k] = ZZ_p(-1*poly_random_eval_set[t++]);
            set_of_ole_add[k] = random_elems[i][j];
            k++;
        }
    }
        
    if(DEBUG_SETUP) cout << "Sender: evaluated polynomial" << endl;
 
    int num_of_oles = 2*eval_pts.length()*setSize;          

    OLESender ole_sender(port, context, prime, num_of_ole_instances);
    ole_sender.compute_ole(set_of_ole_mul,set_of_ole_add, num_of_oles, Alpha, Beta);
  
}



#endif