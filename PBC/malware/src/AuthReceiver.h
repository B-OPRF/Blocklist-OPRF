#ifndef AUTHRECEIVER_H
#define AUTHRECEIVER_H


#include "NTL/ZZ_pXFactoring.h"
#include "NTL/vec_ZZ_p.h"
#include "NTL/ZZ.h"
#include "NTL/matrix.h"
#include "NTL/vec_vec_ZZ_p.h"
#include "NTL/BasicThreadPool.h"
#include "OLEReceiver.h"

#if defined(__linux__)
        #include <sys/time.h>
        #include <sys/resource.h>
#elif defined(__APPLE__)
        #include <unistd.h>
        #include <sys/resource.h>
        #include <mach/mach.h>
#endif

using namespace std;
using std::vector;
using namespace chrono;
using namespace NTL;
#define DEBUG_SETUP 0
#define DEBUG_COMMIT 0


void authenticateR(int port, ZZ_pContext context, ZZ prime, int num_of_ole_instances, vec_ZZ_p Alpha, vec_ZZ_p Beta, vec_ZZ_p eval_pts, vec_ZZ_p *inSet) {
    int party = 1;

    NetIO* io;
    io = new NetIO(party == ALICE?nullptr:"127.0.0.1",port+2); 

    int setSize = 1;

    ZZ_pX inPolys[setSize];
       
    for(int i = 0 ; i < setSize; i++)
    {
        inPolys[i] = BuildFromRoots(inSet[i]);
    }
        
    if(DEBUG_SETUP) cout << "Recv: poly built from root" << endl;     
        
    vec_ZZ_p poly_ole_eval_set;
    poly_ole_eval_set.SetLength(eval_pts.length() * setSize);
    for(int i = 0, k = 0; i < setSize; i++)
    {
        for(int j = 0; j < eval_pts.length(); j++)
        {
            poly_ole_eval_set[k++] = eval(inPolys[i], eval_pts[j]);
        }
    }


    vec_ZZ_p set_of_ole_inputs;
    set_of_ole_inputs.SetLength(2*eval_pts.length()*setSize);
    int k = 0;

    for(int i = 0; i < setSize; i++)
    {
        for(int j = 0; j < eval_pts.length(); j++)
        {
            set_of_ole_inputs[k] = poly_ole_eval_set[k];
            k++;
        }
    }

    for(int i = 0, t = 0; i < setSize; i++)
    {
        for(int j = 0; j < eval_pts.length(); j++)
        {
            set_of_ole_inputs[k] = poly_ole_eval_set[t++];
            k++;
        }
    }

    if(DEBUG_SETUP) cout << "Recv: evaluated polynomial" << endl;



    int num_of_oles = 2*eval_pts.length()*setSize;          // a number that is a multiple of 50

    OLEReceiver ole_receiver(port, context, prime, num_of_ole_instances);

    vec_ZZ_p eval_ole_polys_combined = ole_receiver.compute_ole(set_of_ole_inputs, num_of_oles, Alpha, Beta);

    auto start_time = high_resolution_clock::now();   
    bool ans = (eval_ole_polys_combined == eval_ole_polys_combined);
    auto end_time = high_resolution_clock::now();
    auto duration = duration_cast<milliseconds>(end_time - start_time);
    std::cout << "Server Compare time: " << duration.count() << "ms" << endl; 

}



#endif